<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <title>Schlagwetter: A Minecraft Server</title>
    <link type="text/css" rel="stylesheet" href="default.css">
    <meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
    <style type="text/css">
      html { margin: 0; padding: 0; font-size: medium; font-family: Calibri, "DejaVu Sans", "Trebuchet MS", Helvetica, sans-serif; }
      body { margin: 3em auto; max-width: 66em; padding: 0; line-height: 1.5em; }
      h2 { font-size: 1.25em; font-weight: bold; line-height: 1.25em; margin: 1em 0 .5em 0; padding: 0; }
      h1 { font-size: 2em; font-weight: bold; line-height: 1.25em; }
      a:link, a:visited { color: maroon; text-decoration: none; border-bottom: 1px solid #DAA; }
      a:link:hover, a:visited:hover { color: white; border: none; background-color: maroon; }
      code { margin: auto .5ex; background-color: #EEE; }
      p.footnote { font-size: .8em; line-height: 1em; }
      span.subtitle { font-size: .75em; font-weight: normal; font-style: italic; }
      div.listing { font-family: monospace; padding: 0 2em; white-space: pre; }
    </style>
  </head>
  <body>

    <h1>Schlagwetter<br><span class="subtitle">A Minecraft Server</span></h1>

    <p>Please visit the <a href="https://github.com/louisdx/schlagwetter">source code repository</a> on GitHub.</p>

    <p><strong>Download:</strong> <a href="http://github.com/louisdx/schlagwetter/zipball/master">zip ball</a>,
    <a href="http://github.com/louisdx/schlagwetter/tarball/master">tar.gz ball</a>.</p>

    <p><strong>Check out:</strong> <code>git clone git://github.com/louisdx/schlagwetter</code> (see below)</p>

    <p><em>Schlagwetter</em> is an open-source project to create a server for <a href="http://www.minecraft.net/">Minecraft</a>.
    While there are several other similar projects, both free and commercial, I decided to start my own with specific
    design goals in mind.</p>

    <p style="text-align: center;"><img src="mcshot.jpg" alt="A cave."></p>

    <h2>News and current status</h2>

    <p>May 16, 2011: Using the new client 1.6.3 seems to work without
    changes on the server, but the client behaves very poorly; we are
    investigating whether this is due to the server, and perhaps we
    should wait for the 1.6 version to stabilize.</p>

    <p>Meanwhile, progress is made towards the persistent inventory
    system. We welcome any contributions or suggestions! A nice
    terrain generator would be a great addition at this point.</p>

    <p>May 17, 2011: [returned from holiday] Basic multiplayer should be possible, players see each
    other&rsquo;s avatars.</p>

    <p>April 19, 2011: Updated for compatibility with client 1.5. Several block and item handlers
    have been added, torches, stairs and doors are now available. Basic inventory handling is
    available (mined blocks will drop spawns that can be picked up), though the inventory is not
    yet persistent.</p>

    <p>April 10, 2011: Basic networking framework is set up.
    The <em>Minecraft</em> protocol has been implemented as stubs, but not yet written
    out very much (digging and block placement work). Basic persistent storage is
    available: You can load a world from an arbitrarily named file, save to a (currently fixed) file,
    and import NBT region files to Schlagwetter&rsquo;s format (just plain zipped raw chunk data, essentially)
    with the "nbtimporter" tool.</p>

    <h2>Design goals</h2>

    <ul>
      <li>Free and open source.</li>
      <li>Written in a modern, compiled language; specifically C++0x.</li>
      <li>Simple and monolithic: All other projects I have seen have developed a large,
      intricate plug-in system in which even the core game itself is a plug-in. I prefer
      to write clean and portable code which can be extended at the source level and
      recompiled when needed. <em>Don't abstract until you need to.</em>
      <li>Standard-compliant and platform independent: Using the new C++0x STL and Boost
      (<a href="http://www.boost.org/doc/libs/1_46_1/doc/html/boost_asio.html">ASIO</a>, mainly),
      I have not yet needed to write a single line of platform-dependent code. With any
      luck, that trend will continue.*</li>
      <li>Correctness. Being a server application, the program must be 100% correct. No memory
      leaks or undefined behaviour are acceptable. Every commit to the project must pass
      a run of <a href="http://valgrind.org/">Valgrind</a> without errors&dagger; and compile
      with GCC flags <code>-W -Wall -pedantic</code>.
    </ul>

    <p class="footnote">*) A possible exception will be memory mapping for the persistent storage.
    I do not know any platform-independent framework for that (but we will write one if we need to).
    <em>Update:</em> Having used Boost.iostreams for the serialization code, I am optimistic that Boost
    will even allow for a platform-independent approach to memory mapping.</p>
    <p class="footnote">&dagger;) I would have said &ldquo;without un-freed memory&rdquo;, too, but
    GNU Readline does not seem to clean up and throws this off. Assistance welcome!</p>

    <h2>Libraries</h2>

    <p>I follow the motto &ldquo;reuse, don't reinvent&rdquo; and try to use good libraries
    where possible rather than rolling my own solutions. Thankfully, many useful concepts are
    provided by the new C++ standard library (hash containers, threads, smart pointers),
    and networking primitives are entirely taken care of by Boost.Asio. A few more libraries are
    required and used with gratitude to their creators:

    <ul>
      <li><a href="http://zlib.net/">zlib</a> for chunk compression.</li>
      <li><a href="http://libnoise.sourceforge.net">libnoise</a> for terrain generation.</li>
      <li><a href="https://github.com/FliPPeh/cNBT">cNBT</a>, a C library for handling NBT data structures.</li>
      <li>Boost components: <a href="http://www.boost.org/doc/libs/release/libs/asio/">asio</a>,
          <a href="http://www.boost.org/doc/libs/release/libs/iostreams/index.html">iostreams</a>,
          <a href="http://www.boost.org/doc/libs/release/libs/filesystem/index.html">filesystem</a>,
          <a href="http://www.boost.org/doc/html/program_options.html">program_options</a>,
          <a href="http://www.boost.org/doc/libs/release/libs/regex/">regex</a> (until STL support is ready).</li>
      <li>[optional] <a href="http://cnswww.cns.cwru.edu/php/chet/readline/rltop.html">GNU Readline</a> for the server user interface.</li>
    </ul>

    <h3>Obtaining</h3>

    <p>GitHub manages the repository, you can either download a compressed archive (see above),
    or use git directly:</p>
    <p><code>git clone git://github.com/louisdx/schlagwetter.git</code></p>
    <p>You will also need to obtain the cNBT submodule:</p>
    <p><code>cd schlagwetter</code><br><code>git submodule update --init</code></p>

    <h3>Build requirements</h3>

    <ul>
      <li>The above libraries. The libraries libnoise and zlib should be easily available or buildable for your platform.
      <a href="http://www.boost.org/">Boost</a> is a bit of a monster, but very well supported (you need the boost_program_options,
      boost_iostreams, boost_regex, boost_filesystem and boost_system dynamic libraries, and a bunch of header-only modules).
      As for cNBT, it's included in the repository as a linked submodule, and you need to retrieve it separately (but git can do this
      for you, see above and below).</li>
      <li>If you have <a href="http://www.cmake.org/">cmake</a>, everything should work with very little effort (though I only tested
      it on Linux (Ubuntu); I would be delighted to hear about other platforms). Even if you don't have cmake, you could still try and
      build all the <code>src/*.cpp</code> files and link them together (excluding <code>tester*.cpp</code> and <code>nbtimporter.cpp</code>);
      if you set all your include paths right to pick up the requisite libraries, this ought to work.</li>
    </ul>

    <h3>Example</h3>

    <p>Let's suppose you are on a Linux machine and you have git and cmake.</p>
    <div class="listing">mkdir /tmp/workspace
cd /tmp/workspace
git clone git://github.com/louisdx/schlagwetter.git
cd schlagwetter
git submodule update --init
mkdir ../buildplace
cd ../buildplace

cmake ../schlagwetter
make

./src/bin/schlagwetter --help
./src/bin/schlagwetter</div>


    <p>Any suggestions for improving the build environment are most welcome!</p>


    <h2>World file format</h2>

    <p>I decided to keep things simple. The entire world is kept in
    two files, <code>basename.idx</code> and <code>basename.dat</code>
    (the basename is freely choosable). Both files are compressed and read
    and written with Boost.iostream's zlib-filtered stream. Ignoring
    the transparent compression, the underlying file structure is very
    simple: The data file consists simply of consecutive blocks of 48KiB
    bytes of data, each being the block type (32KiB) and block metadata
    (16KiB) of one chunk. The index file runs in parallel and consists
    of flat, 12-byte entires (all values machine-endian):</p>
    <div class="listing">int32_t chunk_X;
int32_t chunk_Z;
int32_t counter;</div>
    <p>You can either read both files in parallel to obtain all chunks,
    or jump directly to a desired chunk at offset <code>counter * 49152</code>
    in the data file.</p>
    <p><strong>To do:</strong> Perhaps it would be better to replace the counter variable
    with the true offset in the compressed file. The entire model assumes that you can hold
    all chunks in memory; though I suppose an arbitrary number of index/data pairs could
    be freely mixed if splitting up is desired.</p>

    <h2>Known Issues</h2>

    <ul>
      <li>Sometimes the client throws you out with a connection error of some sort. Just try connecting again.</li>
    </ul>

    <h2>License</h2>

    <p>I have not yet worked out the details; it will be something with &ldquo;attribution&rdquo; that is
    compatible with the other libraries and source code that I use. Any advice would be much appreciated.</p>

    <h2>Credits</h2>

    <p>Many thanks to the developers of <a href="https://github.com/fador/mineserver">mineserver</a>
    for the inspiration for this project, lots of practical help and source code. If possible, I would
    like to keep the high-level constructs similar to theirs and make changes visible upstream. I am also
    grateful to the developers of <a href="http://mc.kev009.com/Craftd:Main_Page">craftd</a> and
    <a href="http://brutal-chaos.github.com/">Bravo</a> for two very promising projects.</p>

    <p>If you like to help out, just send me a message on <a href="https://github.com/louisdx/schlagwetter">GitHub</a>,
    <a href="mailto:yoursecretsaresafe@googlemail.com">email me patches or suggestions</a>, or send pull requests.</p>

    <p style="text-align: right; font-style: italic;">louisdx</p>

  </body>
</html>
